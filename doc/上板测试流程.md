# 矩阵计算器上板测试流程

本文档提供INPUT模式、GENERATE模式和DISPLAY模式的详细上板测试流程，覆盖所有功能点。

---

## 一、INPUT模式测试流程

### 1.1 准备工作

1. **硬件连接**
   - 连接EGO1开发板到PC（USB转串口）
   - 确认串口参数：115200波特率，8数据位，1停止位，无校验
   - 打开串口调试助手（或PC端UI）

2. **初始状态检查**
   - 开发板上电，观察LED状态
   - J3（ERROR）应熄灭
   - J2（BUSY）应熄灭
   - K2（DONE）应熄灭
   - 七段数码管应显示空白或菜单状态

### 1.2 基础功能测试

#### 测试用例1：正常输入2×3矩阵

**步骤：**
1. **设置拨码开关**
   - sw[1:0] = `00`（INPUT模式）
   - 其他开关保持默认（0）

2. **进入INPUT模式**
   - 按下按键V1（key[0]，确认键）
   - 观察数码管：应显示 "I"（INPUT模式标识）

3. **通过UART发送矩阵数据**
   - 在串口调试助手发送窗口输入：`2 3 4 5 6 7 8 9`
   - 点击"发送"按钮
   - **数据格式说明**：
     - `2` = 行数m
     - `3` = 列数n
     - `4 5 6 7 8 9` = 矩阵元素（按行优先：A00, A01, A02, A10, A11, A12）

4. **观察系统响应**
   - LED状态：J3应保持熄灭（无错误）
   - 等待1-2秒，系统完成存储

5. **验证存储**
   - 切换到DISPLAY模式验证（见DISPLAY模式测试）

**预期结果：**
- 矩阵成功存储，无错误提示
- 矩阵ID自动分配（通常为0或1）

---

#### 测试用例2：输入3×3矩阵（完整元素）

**步骤：**
1. 保持sw[1:0] = `00`
2. 按下V1确认键（如已在INPUT模式可跳过）
3. 发送UART数据：`3 3 1 2 3 4 5 6 7 8 9`
   - 含义：3×3矩阵，元素1-9
4. 观察LED：J3应熄灭

**预期结果：**
- 9个元素全部存储
- 矩阵格式：第一行[1,2,3]，第二行[4,5,6]，第三行[7,8,9]

---

#### 测试用例3：输入元素不足的情况（自动补0）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`2 3 1 2 3 4`
   - 含义：2×3矩阵（需要6个元素），但只输入4个
3. 观察系统响应

**预期结果：**
- 系统自动将A11和A12补0
- 最终矩阵：第一行[1,2,3]，第二行[4,0,0]
- 无错误提示（符合项目要求）

---

#### 测试用例4：输入元素过多的情况（截断）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`2 3 1 2 3 4 5 6 7 8`
   - 含义：2×3矩阵（需要6个元素），但输入8个
3. 观察系统响应

**预期结果：**
- 系统只取前6个元素：1,2,3,4,5,6
- 第7、8个元素被忽略
- 最终矩阵：第一行[1,2,3]，第二行[4,5,6]

---

### 1.3 错误处理测试

#### 测试用例5：维度超出范围（m>5）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`6 3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18`
   - 含义：6×3矩阵（m=6超出1-5范围）

**预期结果：**
- J3（ERROR）LED点亮并闪烁
- 七段数码管显示倒计时（默认10秒，可通过CONFIG COUNT配置）
- 倒计时结束后自动返回菜单
- 矩阵未存储

---

#### 测试用例6：维度超出范围（n>5）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`3 6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18`

**预期结果：**
- J3（ERROR）LED闪烁
- 倒计时显示
- 矩阵未存储

---

#### 测试用例7：元素值超出范围（>9，需先配置范围）

**前置条件：**
- 先通过CONFIG RANGE设置元素范围（见配置测试）

**步骤：**
1. 假设已配置范围[0,9]
2. sw[1:0] = `00`，按下V1
3. 发送：`2 2 1 2 10 4`
   - 含义：2×2矩阵，元素10超出范围

**预期结果：**
- J3（ERROR）LED闪烁
- 倒计时显示
- 矩阵未存储

---

#### 测试用例8：元素值超出范围（<0，负数）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`2 2 -1 2 3 4`
   - 如果系统不支持负数输入，可能解析为其他值

**预期结果：**
- 根据实际实现，可能报错或忽略负号

---

### 1.4 存储覆盖测试

#### 测试用例9：同规格矩阵覆盖（默认每种规格最多2个）

**步骤：**
1. **第一次输入**
   - sw[1:0] = `00`，按下V1
   - 发送：`2 2 1 2 3 4`（矩阵A）

2. **第二次输入（相同规格）**
   - 保持INPUT模式
   - 发送：`2 2 5 6 7 8`（矩阵B，覆盖A）

3. **第三次输入（相同规格）**
   - 发送：`2 2 9 0 1 2`（矩阵C，覆盖B）

**预期结果：**
- 系统最多保存2个2×2矩阵
- 新矩阵覆盖最旧的同规格矩阵
- 可通过DISPLAY模式验证覆盖情况

---

### 1.5 配置相关测试

#### 测试用例10：配置元素范围后输入

**步骤：**
1. **配置元素范围**
   - 在任意模式下，通过UART发送：`CONFIG RANGE 0 15`
   - 等待配置完成

2. **输入矩阵（元素值在0-15范围内）**
   - sw[1:0] = `00`，按下V1
   - 发送：`2 2 10 11 12 13`

**预期结果：**
- 矩阵成功存储
- 元素值10-13在配置范围内，无错误

---

#### 测试用例11：配置每种规格最大数量

**步骤：**
1. **配置最大数量**
   - 发送：`CONFIG MAX 3`
   - 含义：每种规格最多存储3个矩阵

2. **输入多个同规格矩阵**
   - sw[1:0] = `00`，按下V1
   - 连续输入4个2×2矩阵

**预期结果：**
- 前3个矩阵正常存储
   - 第4个矩阵覆盖第1个（如果实现为FIFO覆盖）

---

### 1.6 边界值测试

#### 测试用例12：最小矩阵（1×1）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`1 1 5`

**预期结果：**
- 成功存储1×1矩阵，元素值为5

---

#### 测试用例13：最大矩阵（5×5）

**步骤：**
1. sw[1:0] = `00`，按下V1
2. 发送：`5 5` + 25个元素值（0-9）
   - 例如：`5 5 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4`

**预期结果：**
- 成功存储5×5矩阵（25个元素）

---

### 1.7 模式切换测试

#### 测试用例14：INPUT模式中返回菜单

**步骤：**
1. sw[1:0] = `00`，按下V1进入INPUT模式
2. 按下R17（key[1]，返回键）

**预期结果：**
- 返回主菜单
- 数码管显示空白或菜单标识

---

#### 测试用例15：快速返回菜单

**步骤：**
1. 在INPUT模式下
2. 按下key[3]（快速菜单键，如果实现）

**预期结果：**
- 立即返回主菜单

---

---

## 二、GENERATE模式测试流程

### 2.1 准备工作

1. **硬件连接**（同INPUT模式）
2. **初始状态检查**（同INPUT模式）

### 2.2 基础功能测试

#### 测试用例1：生成1个2×2随机矩阵

**步骤：**
1. **设置拨码开关**
   - sw[1:0] = `01`（GENERATE模式）

2. **进入GENERATE模式**
   - 按下按键V1（确认键）
   - 观察数码管：应显示 "G"（GENERATE模式标识）

3. **通过UART发送生成命令**
   - 在串口调试助手发送窗口输入：`2 2 1`
   - 点击"发送"
   - **数据格式说明**：
     - `2` = 行数m
     - `2` = 列数n
     - `1` = 生成矩阵个数

4. **观察系统响应**
   - LED状态：
     - J2（BUSY）应点亮（生成进行中）
     - 生成完成后，K2（DONE）应点亮3秒后熄灭
   - 等待生成完成（通常1-2秒）

5. **验证生成结果**
   - 切换到DISPLAY模式查看生成的矩阵
   - 检查元素值是否在配置范围内（默认0-9）

**预期结果：**
- 成功生成1个2×2随机矩阵
- 矩阵元素值在[0,9]范围内（或配置的范围）
- 矩阵已自动存储

---

#### 测试用例2：生成2个3×3随机矩阵

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`3 3 2`
   - 含义：生成2个3×3矩阵

3. **观察系统响应**
   - J2（BUSY）点亮
   - 等待生成完成（2个矩阵需要更长时间）
   - K2（DONE）点亮

**预期结果：**
- 成功生成2个3×3随机矩阵
- 两个矩阵的元素值不同（随机性验证）
- 两个矩阵都已存储

---

#### 测试用例3：生成多个矩阵（测试随机性）

**步骤：**
1. sw[1:0] = `01`，按下V1
2. **第一次生成**
   - 发送：`2 2 1`
   - 记录生成的矩阵元素值

3. **第二次生成（相同规格）**
   - 发送：`2 2 1`
   - 记录生成的矩阵元素值

**预期结果：**
- 两次生成的矩阵元素值**不同**（验证随机性）
- 如果相同，说明随机数生成器有问题（不得分）

---

### 2.3 配置范围测试

#### 测试用例4：配置元素范围后生成

**步骤：**
1. **配置元素范围**
   - 发送：`CONFIG RANGE 5 9`
   - 等待配置完成

2. **生成矩阵**
   - sw[1:0] = `01`，按下V1
   - 发送：`3 3 1`

**预期结果：**
- 生成的矩阵元素值全部在[5,9]范围内
- 无元素值小于5或大于9

---

#### 测试用例5：配置负数范围（如果支持）

**步骤：**
1. **配置负数范围**
   - 发送：`CONFIG RANGE -3 3`
   - 等待配置完成

2. **生成矩阵**
   - sw[1:0] = `01`，按下V1
   - 发送：`2 2 1`

**预期结果：**
- 生成的矩阵元素值在[-3,3]范围内
- 可能包含负数（根据实际实现）

---

### 2.4 边界值测试

#### 测试用例6：生成最小矩阵（1×1）

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`1 1 1`

**预期结果：**
- 成功生成1×1随机矩阵
- 元素值在配置范围内

---

#### 测试用例7：生成最大矩阵（5×5）

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`5 5 1`

**预期结果：**
- 成功生成5×5随机矩阵（25个元素）
- 所有元素值在配置范围内

---

#### 测试用例8：生成最大数量矩阵

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`2 2 2`（假设默认每种规格最多2个）

**预期结果：**
- 成功生成2个2×2矩阵
- 如果已存在同规格矩阵，可能被覆盖

---

### 2.5 错误处理测试

#### 测试用例9：维度超出范围

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`6 3 1`（m=6超出范围）

**预期结果：**
- J3（ERROR）LED闪烁
- 倒计时显示
- 未生成矩阵

---

#### 测试用例10：生成数量超出限制

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`2 2 10`（生成10个，可能超出存储限制）

**预期结果：**
- 根据实现，可能：
  - 只生成允许的最大数量
  - 或报错

---

### 2.6 生成后显示测试

#### 测试用例11：生成后自动显示（如果实现）

**步骤：**
1. sw[1:0] = `01`，按下V1
2. 发送：`2 2 1`
3. 等待生成完成

**预期结果：**
- 如果系统实现自动显示，UART应输出生成的矩阵
- 格式：清晰的矩阵展示（元素间空格，行间换行）

---

### 2.7 模式切换测试

#### 测试用例12：GENERATE模式中返回菜单

**步骤：**
1. sw[1:0] = `01`，按下V1进入GENERATE模式
2. 按下R17（返回键）

**预期结果：**
- 返回主菜单
- 如果正在生成，可能中断或完成后再返回

---

---

## 三、DISPLAY模式测试流程

### 3.1 准备工作

1. **前置条件**
   - 确保已通过INPUT或GENERATE模式存储了至少1个矩阵
   - 建议准备多个不同规格的矩阵用于测试

2. **硬件连接**（同前）

### 3.2 基础功能测试

#### 测试用例1：显示单个矩阵

**步骤：**
1. **设置拨码开关**
   - sw[1:0] = `10`（DISPLAY模式）

2. **进入DISPLAY模式**
   - 按下按键V1（确认键）
   - 观察数码管：应显示当前矩阵编号（如"0"）

3. **观察UART输出**
   - 串口调试助手接收窗口应显示矩阵
   - **预期格式示例**（2×3矩阵）：
     ```
     Matrix 0 (2x3):
     4 5 6
     7 8 9
     ```
   - 或简化格式：
     ```
     4 5 6
     7 8 9
     ```

**预期结果：**
- UART清晰显示矩阵内容
- 元素间有空格分隔
- 行间有换行
- 数码管显示矩阵编号

---

#### 测试用例2：浏览下一个矩阵

**步骤：**
1. sw[1:0] = `10`，按下V1进入DISPLAY模式
2. 观察当前显示的矩阵编号（数码管）
3. **按下R11（key[2]，下一个键）**
4. 观察UART输出和数码管

**预期结果：**
- 数码管显示的矩阵编号递增（如0→1）
- UART显示下一个矩阵的内容
- 如果到达最后一个矩阵，可能循环回0或停止

---

#### 测试用例3：显示空槽位（如果存在）

**步骤：**
1. sw[1:0] = `10`，按下V1
2. 连续按下R11，浏览所有矩阵槽位

**预期结果：**
- 如果某个槽位为空，UART可能显示：
  - "Empty"
  - 或空白
  - 或错误提示
- 数码管仍显示槽位编号

---

### 3.3 不同规格矩阵显示测试

#### 测试用例4：显示1×1矩阵

**步骤：**
1. 确保已存储1×1矩阵
2. sw[1:0] = `10`，按下V1
3. 浏览到该矩阵

**预期结果：**
- UART显示：
  ```
  Matrix X (1x1):
  5
  ```
- 格式清晰

---

#### 测试用例5：显示5×5矩阵

**步骤：**
1. 确保已存储5×5矩阵
2. sw[1:0] = `10`，按下V1
3. 浏览到该矩阵

**预期结果：**
- UART显示完整的5×5矩阵
- 5行，每行5个元素
- 格式清晰，易于阅读

---

#### 测试用例6：显示不同规格矩阵序列

**步骤：**
1. 确保已存储多个不同规格矩阵：
   - 1×1矩阵
   - 2×3矩阵
   - 3×3矩阵
   - 5×2矩阵
2. sw[1:0] = `10`，按下V1
3. 连续按下R11，浏览所有矩阵

**预期结果：**
- 每个矩阵都能正确显示
- 矩阵编号正确对应
- 格式清晰，不会混淆

---

### 3.4 显示格式验证

#### 测试用例7：验证显示格式清晰度

**步骤：**
1. sw[1:0] = `10`，按下V1
2. 显示一个2×3矩阵

**预期结果：**
- **格式要求**（根据项目文档）：
  - 元素之间以空格分隔
  - 行之间以换行分隔
  - 可选的标题行（如"Matrix 0 (2x3):"）
- **示例**：
  ```
  Matrix 0 (2x3):
  4 5 6
  7 8 9
  ```
  或
  ```
  4 5 6
  7 8 9
  ```

---

#### 测试用例8：显示多个矩阵（如果支持）

**步骤：**
1. sw[1:0] = `10`，按下V1
2. 如果系统支持一次显示多个矩阵，观察输出

**预期结果：**
- 多个矩阵从上到下依次显示
- 矩阵之间有明确分隔（空行或标识）

---

### 3.5 边界情况测试

#### 测试用例9：无矩阵可显示

**步骤：**
1. **清空所有矩阵**（如果可能，或使用全新系统）
2. sw[1:0] = `10`，按下V1

**预期结果：**
- 可能显示：
  - "No matrices available"
  - 或空白
  - 或错误提示
- 数码管可能显示0或空白

---

#### 测试用例10：显示刚生成的矩阵

**步骤：**
1. **在GENERATE模式下生成矩阵**
   - sw[1:0] = `01`，按下V1
   - 发送：`2 2 1`
   - 等待生成完成

2. **立即切换到DISPLAY模式**
   - sw[1:0] = `10`，按下V1

**预期结果：**
- 能正确显示刚生成的矩阵
- 矩阵内容与生成的一致

---

#### 测试用例11：显示运算结果矩阵

**步骤：**
1. **执行一次矩阵运算**（在OPERATION模式下）
   - 例如：矩阵加法
   - 运算结果自动存储

2. **切换到DISPLAY模式**
   - sw[1:0] = `10`，按下V1
   - 浏览到结果矩阵

**预期结果：**
- 能正确显示运算结果
- 结果矩阵的维度正确
- 元素值正确

---

### 3.6 模式切换测试

#### 测试用例12：DISPLAY模式中返回菜单

**步骤：**
1. sw[1:0] = `10`，按下V1进入DISPLAY模式
2. 按下R17（返回键）

**预期结果：**
- 返回主菜单
- 数码管显示菜单状态

---

#### 测试用例13：快速返回菜单

**步骤：**
1. 在DISPLAY模式下
2. 按下key[3]（如果实现快速菜单键）

**预期结果：**
- 立即返回主菜单

---

### 3.7 实时更新测试

#### 测试用例14：显示后修改矩阵（如果可能）

**步骤：**
1. sw[1:0] = `10`，按下V1，显示矩阵0
2. **切换到INPUT模式，覆盖矩阵0**
   - sw[1:0] = `00`，按下V1
   - 发送相同规格的新矩阵数据

3. **切换回DISPLAY模式**
   - sw[1:0] = `10`，按下V1

**预期结果：**
- 显示更新后的矩阵内容
- 旧内容已被新内容覆盖

---

---

## 四、通用测试项

### 4.1 配置命令测试（所有模式通用）

#### 测试用例：CONFIG RANGE

**步骤：**
1. 在任意模式下（或菜单模式）
2. 通过UART发送：`CONFIG RANGE 0 15`
3. 观察系统响应

**预期结果：**
- 配置成功（可能无显式提示，或LED指示）
- 后续INPUT/GENERATE模式使用新范围

---

#### 测试用例：CONFIG MAX

**步骤：**
1. 发送：`CONFIG MAX 3`
2. 验证存储限制是否更新

**预期结果：**
- 每种规格最多存储数量更新为3

---

#### 测试用例：CONFIG COUNT（倒计时）

**步骤：**
1. 发送：`CONFIG COUNT 15`
2. 触发一个错误（如维度超范围）

**预期结果：**
- 错误倒计时显示15秒（而非默认10秒）

---

### 4.2 LED和数码管综合测试

#### 测试用例：状态指示完整性

**测试场景：**
1. **正常操作**
   - J3（ERROR）熄灭
   - J2（BUSY）在运算/生成时点亮
   - K2（DONE）在完成时点亮3秒

2. **错误情况**
   - J3（ERROR）闪烁
   - 数码管显示倒计时

3. **模式指示**
   - INPUT模式：显示"I"
   - GENERATE模式：显示"G"
   - DISPLAY模式：显示矩阵编号

---

### 4.3 串口通信稳定性测试

#### 测试用例：连续操作

**步骤：**
1. 连续执行多个操作：
   - INPUT → DISPLAY → GENERATE → DISPLAY
2. 观察UART通信是否稳定

**预期结果：**
- 无数据丢失
- 无通信错误
- 响应及时

---

## 五、测试检查清单

### INPUT模式检查清单
- [ ] 正常输入各种规格矩阵（1×1到5×5）
- [ ] 元素不足自动补0
- [ ] 元素过多自动截断
- [ ] 维度超范围报错
- [ ] 元素值超范围报错
- [ ] 同规格矩阵覆盖功能
- [ ] 配置范围后输入
- [ ] 模式切换正常

### GENERATE模式检查清单
- [ ] 生成单个矩阵
- [ ] 生成多个矩阵
- [ ] 随机性验证（相同输入生成不同结果）
- [ ] 配置范围后生成
- [ ] 边界值测试（1×1，5×5）
- [ ] 维度超范围报错
- [ ] 生成后存储验证

### DISPLAY模式检查清单
- [ ] 单个矩阵显示清晰
- [ ] 浏览下一个矩阵
- [ ] 不同规格矩阵正确显示
- [ ] 显示格式符合要求（空格、换行）
- [ ] 空槽位处理
- [ ] 显示刚生成的矩阵
- [ ] 显示运算结果
- [ ] 模式切换正常

### 通用检查清单
- [ ] LED状态指示正确
- [ ] 数码管显示正确
- [ ] UART通信稳定
- [ ] 配置命令生效
- [ ] 错误处理完善
- [ ] 倒计时功能正常

---

## 六、常见问题排查

### 问题1：UART无响应
- 检查串口参数（115200,8N1）
- 检查硬件连接
- 检查开发板是否正常运行

### 问题2：矩阵未存储
- 检查维度是否在1-5范围内
- 检查元素值是否在配置范围内
- 检查LED错误指示

### 问题3：显示格式混乱
- 检查UART接收窗口设置
- 检查换行符处理
- 检查元素分隔符

### 问题4：随机数不随机
- 检查LFSR实现
- 验证不同时间生成的矩阵是否不同

---

## 七、测试记录表模板

| 测试用例 | 模式 | 输入数据 | 预期结果 | 实际结果 | 通过/失败 | 备注 |
|---------|------|---------|---------|---------|----------|------|
| 1.1 | INPUT | 2 3 4 5 6 7 8 9 | 存储2×3矩阵 | | | |
| 2.1 | GENERATE | 2 2 1 | 生成随机矩阵 | | | |
| 3.1 | DISPLAY | - | 显示矩阵 | | | |

---

**文档版本：** v1.0  
**最后更新：** 2024年  
**适用项目：** CS207 FPGA矩阵计算器

